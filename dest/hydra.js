function LRUCache(e){this.size=e||50,this.cache=[],this.map={}}window.hydra={},DOMParser||(window.DOMParser=function(){},DOMParser.prototype.parseFromString=function(e,t){if(/^\s*text\/html\s*(?:;|$)/i.test(t)){var n=document.implementation.createHTMLDocument("");return e.toLowerCase().indexOf("<!doctype")>-1?n.documentElement.innerHTML=e:n.body.innerHTML=e,n}});var _=function(){var e={};return e.loadCache={},e.uid=0,typeof /./!="function"&&(e.isFunction=function(e){return typeof e=="function"}),e.isObject=function(e){return e===Object(e)},e.isArray=function(e){return e.length!==undefined?!0:toString.call(e)=="[object Array]"},e.isEmptyObject=function(t){if(t==null)return!0;for(var n in t)if(e.has(t,n))return!1;return!0},e.trim=function(e){return e?e.replace(/^\s*|\s*$/g,""):""},e.has=function(e,t){return e!=null&&Object.prototype.hasOwnProperty.call(e,t)},e.keys=function(t){if(!e.isObject(t))return[];if(Object.keys)return Object.keys(t);var n=[];for(var r in t)e.has(t,r)&&n.push(r);return n},e.each=function(t,n,r){if(t==null)return t;if(t.length===+t.length){for(var i=0,s=t.length;i<s;i++)if(n.call(r,i,t[i],t))return}else{var o=e.keys(t);for(var i=0,s=o.length;i<s;i++)if(n.call(r,o[i],t[o[i]],t))return}return t},e.extend=function(t){return e.isObject(t)?(e.each(Array.prototype.slice.call(arguments,1),function(e,n){for(var r in n)n[r]&&(t[r]=n[r])}),t):t},e.copy=function(t){return e.isObject(t)?(e.each(Array.prototype.slice.call(arguments,1),function(e,n){for(var r in n)t.prototype[r]=n[r]}),t):t},e.clone=function(t){return e.isObject(t)?e.isArray(t)?t.slice():e.extend({},t):t},e.param=function(t){var n=[];return e.each(t,function(e,t){n.push(e+"="+encodeURIComponent(t))}),n.join("&")},e.getUrlParam=function(e){var t=location.search,n={};return t&&(t=t.slice(1).split("&"),t.forEach(function(e){var t=e.split("=");n[t[0]]=decodeURIComponent(t[1])})),n[e]},e.md5=function(t){var n=t||3,r=0,i="";for(;r<n;r++)i+=Math.floor(Math.random()*65535).toString(32)+e.uuid();return i},e.uuid=function(){return++e.uid},e.render=function(t,n,r){return t.replace(/\{\{(.*?)\}\}/g,function(t,i){if(e.isFunction(r))return r(i,n);var s,o,u;if(i.indexOf("|")>0){var a=i.split("|");s=e.trim(a[0]),u=e.trim(a[1])}else s=e.trim(i);var f;if(s.indexOf(".")!=-1){var f=s.split("."),o=n[f[0]];e.each(f,function(e,t){e>0&&o&&(o=o[t])})}else o=n[s];if(u){var l=u.match(/\s*in(\{.*?\})/);if(l&&l.length>1){var c=(new Function("","return "+l[1]))();c&&(o=c[o]?c[o]:"")}else r.filter&&r.filter[u]?o=r.filter[u](o):console.error("filter["+u+"] not exist")}return o})},e.recurse=function(t,n){var r=t.children;r.length>0&&e.each(r,function(t,r){r.nodeType==1&&(n(r),e.recurse(r,n))})},e.upFirstLetter=function(e){return e.replace(/(\w)/,function(e){return e.toUpperCase()})},e.downFirstLetter=function(e){return e.replace(/(\w)/,function(e){return e.toLowerCase()})},e.loadCss=function(t){if(t){if(e.loadCache[t])return;e.loadCache[t]=!0;var n=document.getElementsByTagName("head")[0],r=document.createElement("link");r.href=t,r.rel="stylesheet",r.type="text/css",n.appendChild(r)}},e.loadJs=function(t,n,r){if(e.loadCache[t]){n&&n();return}e.loadCache[t]=!0;var i=document.getElementsByTagName("head")[0],s=document.createElement("script");return s.onload=function(){n&&n()},s.onerror=function(){r&&r()},s.type="text/javascript",s.src=t,i.appendChild(s),s},e.runJs=function(t,n,r){if(e.loadCache[t])return;e.loadCache[t]=!0;var i=document.getElementsByTagName("head")[0],s=document.createElement("script");return s.onload=function(){n&&n()},s.onerror=function(){r&&r()},s.type="text/javascript",s.src=t,i.appendChild(s),s},e.ajax=function(){function t(t,n,r,i,s){var o=null;window.XMLHttpRequest?o=new XMLHttpRequest:window.ActiveXObject&&(o=new ActiveXObject("Microsoft.XMLHTTP"));if(o!=null){var u=t,a=e.param(r);a&&(u=t+"?"+a),o.open(n,u,!0),o.onreadystatechange=function(){if(o.readyState==4&&o.status==200){var e=o.responseText;s&&s(e)}}}var f;if(i){var l=[];for(var c in i)l.push(c+"="+encodeURIComponent(i[c]));f=l.join("&"),f.length&&o.setRequestHeader("Content-type","application/x-www-form-urlencoded")}o.send(f)}return{get:function(e,n,r){t(e,"GET",n,null,r)},post:function(e,n,r,i){t(e,"POST",n,r,i)}}}(),e}(),DomEvent={on:function(e,t,n,r){var i="",s=r===undefined?!0:r,o=null;return window.addEventListener===undefined?(i="on"+e,o=function(e,n){return t.attachEvent(e,n),n}):(i=e,o=function(e,n,r){return t.addEventListener(e,n,r),n}),o.apply(t,[i,function(e){var t=e||event,r=t.srcElement||t.target;n(t,r)},s])},delegate:function(e,t,n,r){var i=this;i._events||(i._events={});var s=e.id;i._events[s]||(i._events[s]={});var o=!1;if(n=="blur"||n=="focus")n=n=="blur"?"focusout":n=="focus"?"focusin":n;i._events[s][n]?i._events[s][n].push({selector:t,fn:r}):(i._events[s][n]=[{selector:t,fn:r}],e.addEventListener(n,function(t){var r=i._events[s][n],o=t.target;for(var u=0,a=r.length;u<a;u++){var f=r[u],l=e.querySelectorAll(f.selector);if(l)for(var c=0,h=l.length;c<h;c++){var p=l[c];if(p===o||p.contains(o)){t.currentTarget=p,f.fn.call(p,t);return}}}},o))},off:function(e,t,n,r){var i="",s=r===undefined?!0:r;window.removeEventListener===undefined?(i="on"+e,t[i]=null):(i=e,t.removeEventListener(i,n,s))},stopPropagation:function(e){e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()},preventDefault:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},swipeLeft:function(e,t){this.swipe(e,function(e,n){n.direction===DIR.LEFT&&t.apply(this,arguments)})},swipe:function(e,t){startTrack();var n=!1,r=DIR.NONE;dispatcher.on("touchstart",function(){n=!1}),this.on(e,"touchmove",function(e,r){if(n||Math.abs(r.xSpeed)<1&&Math.abs(r.ySpeed)<1)return;r.direction=getDirectionFromXY(r.dx,r.dy),t.apply(this,arguments),n=!0})},swipeRight:function(e,t){this.swipe(e,function(e,n){n.direction===DIR.LEFT&&t.apply(this,arguments)})},swipeTop:function(e,t){this.swipe(e,function(e,n){n.direction===DIR.TOP&&t.apply(this,arguments)})},swipeBottom:function(e,t){this.swipe(e,function(e,n){n.direction===DIR.BOTTOM&&t.apply(this,arguments)})}},Event={on:function(e,t){this._events||(this._events={}),this._events[e]=t},off:function(e){delete this._events[e]},dispatchEvent:function(){var e=Array.prototype.slice.call(arguments,1),t=arguments[0];if(t&&this._events){var n=this._events[t];n&&n.apply(this,_.isArray(e)?e:[e])}}},EventPipe={pipe:function(e){var t=this;t._eventPips||(t._eventPips={}),t._eventPips[e]||(t._eventPips[e]=[]);var n=t._eventPips[e];return{receive:function(e){for(var t in e)n.push({eventType:t,func:e[t],level:5})},write:function(e){var r=Array.prototype.slice.call(arguments,1);n.forEach(function(n,i){n.eventType==e&&n.func.apply(t,r)})}}}};LRUCache.prototype.add=function(e,t){if(this.map[e]!==undefined){var n=this.map[e],r=this.cache.splice(n,1);this.cache.unshift(r),this.map[e]=0}else this.cache.length>=this.size?(this.cache[thi.size-1]=t,this.map[e]=thi.size-1):(this.cache.push(t),this.map[e]=this.cache.length-1)},LRUCache.prototype.get=function(e){if(this.map[e])return this.cache[this.map[e]]};function newState(e,t){var n={name:e,state:{},setState:function(e){for(var n in e)this.state[n]=e[n];t()},getState:function(){return this.state}};return n}var StoreUtil={get:function(e,t,n){_.ajax.get(e,t,n)},post:function(e,t,n){_.ajax.post(e,t,n)}};!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.virtualDom=e()}}(function(){var e,t,n;return function r(e,t,n){function i(o,u){if(!t[o]){if(!e[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=t[o]={exports:{}};e[o][0].call(l.exports,function(t){var n=e[o][1][t];return i(n?n:t)},l,l.exports,r,e,t,n)}return t[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,n){var r=e("./vdom/create-element.js");t.exports=r},{"./vdom/create-element.js":15}],2:[function(e,t,n){var r=e("./vtree/diff.js");t.exports=r},{"./vtree/diff.js":35}],3:[function(e,t,n){var r=e("./virtual-hyperscript/index.js");t.exports=r},{"./virtual-hyperscript/index.js":22}],4:[function(e,t,n){var r=e("./diff.js"),i=e("./patch.js"),s=e("./h.js"),o=e("./create-element.js"),u=e("./vnode/vnode.js"),a=e("./vnode/vtext.js");t.exports={diff:r,patch:i,h:s,create:o,VNode:u,VText:a}},{"./create-element.js":1,"./diff.js":2,"./h.js":3,"./patch.js":13,"./vnode/vnode.js":31,"./vnode/vtext.js":33}],5:[function(e,t,n){t.exports=function(t){var n=String.prototype.split,r=/()??/.exec("")[1]===t,i;return i=function(e,i,s){if(Object.prototype.toString.call(i)!=="[object RegExp]")return n.call(e,i,s);var o=[],u=(i.ignoreCase?"i":"")+(i.multiline?"m":"")+(i.extended?"x":"")+(i.sticky?"y":""),a=0,i=new RegExp(i.source,u+"g"),f,l,c,h;e+="",r||(f=new RegExp("^"+i.source+"$(?!\\s)",u)),s=s===t?-1>>>0:s>>>0;while(l=i.exec(e)){c=l.index+l[0].length;if(c>a){o.push(e.slice(a,l.index)),!r&&l.length>1&&l[0].replace(f,function(){for(var e=1;e<arguments.length-2;e++)arguments[e]===t&&(l[e]=t)}),l.length>1&&l.index<e.length&&Array.prototype.push.apply(o,l.slice(1)),h=l[0].length,a=c;if(o.length>=s)break}i.lastIndex===l.index&&i.lastIndex++}return a===e.length?(h||!i.test(""))&&o.push(""):o.push(e.slice(a)),o.length>s?o.slice(0,s):o},i}()},{}],6:[function(e,t,n){},{}],7:[function(e,t,n){"use strict";function o(e){var t=e[s];return t||(t=e[s]={}),t}var r=e("individual/one-version"),i="7";r("ev-store",i);var s="__EV_STORE_KEY@"+i;t.exports=o},{"individual/one-version":9}],8:[function(e,t,n){(function(e){"use strict";function r(e,t){return e in n?n[e]:(n[e]=t,t)}var n=typeof window!="undefined"?window:typeof e!="undefined"?e:{};t.exports=r}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],9:[function(e,t,n){"use strict";function i(e,t,n){var i="__INDIVIDUAL_ONE_VERSION_"+e,s=i+"_ENFORCE_SINGLETON",o=r(s,t);if(o!==t)throw new Error("Can only have one copy of "+e+".\n"+"You already have version "+o+" installed.\n"+"This means you cannot install version "+t);return r(i,n)}var r=e("./index.js");t.exports=i},{"./index.js":8}],10:[function(e,t,n){(function(n){var r=typeof n!="undefined"?n:typeof window!="undefined"?window:{},i=e("min-document");if(typeof document!="undefined")t.exports=document;else{var s=r["__GLOBAL_DOCUMENT_CACHE@4"];s||(s=r["__GLOBAL_DOCUMENT_CACHE@4"]=i),t.exports=s}}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"min-document":6}],11:[function(e,t,n){"use strict";t.exports=function(t){return typeof t=="object"&&t!==null}},{}],12:[function(e,t,n){function s(e){return i.call(e)==="[object Array]"}var r=Array.isArray,i=Object.prototype.toString;t.exports=r||s},{}],13:[function(e,t,n){var r=e("./vdom/patch.js");t.exports=r},{"./vdom/patch.js":18}],14:[function(e,t,n){function s(e,t,n){for(var s in t){var a=t[s];a===undefined?o(e,s,a,n):i(a)?(o(e,s,a,n),a.hook&&a.hook(e,s,n?n[s]:undefined)):r(a)?u(e,t,n,s,a):e[s]=a}}function o(e,t,n,r){if(r){var s=r[t];if(!i(s))if(t==="attributes")for(var o in s)e.removeAttribute(o);else if(t==="style")for(var u in s)e.style[u]="";else typeof s=="string"?e[t]="":e[t]=null;else s.unhook&&s.unhook(e,t,n)}}function u(e,t,n,i,s){var o=n?n[i]:undefined;if(i==="attributes"){for(var u in s){var f=s[u];f===undefined?e.removeAttribute(u):e.setAttribute(u,f)}return}if(o&&r(o)&&a(o)!==a(s)){e[i]=s;return}r(e[i])||(e[i]={});var l=i==="style"?"":undefined;for(var c in s){var h=s[c];e[i][c]=h===undefined?l:h}}function a(e){if(Object.getPrototypeOf)return Object.getPrototypeOf(e);if(e.__proto__)return e.__proto__;if(e.constructor)return e.constructor.prototype}var r=e("is-object"),i=e("../vnode/is-vhook.js");t.exports=s},{"../vnode/is-vhook.js":26,"is-object":11}],15:[function(e,t,n){function f(e,t){var n=t?t.document||r:r,l=t?t.warn:null;e=a(e).a;if(u(e))return e.init();if(o(e))return n.createTextNode(e.text);if(!s(e))return l&&l("Item is not a valid virtual dom node",e),null;var c=e.namespace===null?n.createElement(e.tagName):n.createElementNS(e.namespace,e.tagName),h=e.properties;i(c,h);var p=e.children;for(var d=0;d<p.length;d++){var v=f(p[d],t);v&&c.appendChild(v)}return c}var r=e("global/document"),i=e("./apply-properties"),s=e("../vnode/is-vnode.js"),o=e("../vnode/is-vtext.js"),u=e("../vnode/is-widget.js"),a=e("../vnode/handle-thunk.js");t.exports=f},{"../vnode/handle-thunk.js":24,"../vnode/is-vnode.js":27,"../vnode/is-vtext.js":28,"../vnode/is-widget.js":29,"./apply-properties":14,"global/document":10}],16:[function(e,t,n){function i(e,t,n,r){return!n||n.length===0?{}:(n.sort(u),s(e,t,n,r,0))}function s(e,t,n,i,u){i=i||{};if(e){o(n,u,u)&&(i[u]=e);var a=t.children;if(a){var f=e.childNodes;for(var l=0;l<t.children.length;l++){u+=1;var c=a[l]||r,h=u+(c.count||0);o(n,u,h)&&s(f[l],c,n,i,u),u=h}}}return i}function o(e,t,n){if(e.length===0)return!1;var r=0,i=e.length-1,s,o;while(r<=i){s=(i+r)/2>>0,o=e[s];if(r===i)return o>=t&&o<=n;if(o<t)r=s+1;else{if(!(o>n))return!0;i=s-1}}return!1}function u(e,t){return e>t?1:-1}var r={};t.exports=i},{}],17:[function(e,t,n){function u(e,t,n){var i=e.type,o=e.vNode,u=e.patch;switch(i){case s.REMOVE:return a(t,o);case s.INSERT:return f(t,u,n);case s.VTEXT:return l(t,o,u,n);case s.WIDGET:return c(t,o,u,n);case s.VNODE:return h(t,o,u,n);case s.ORDER:return d(t,u),t;case s.PROPS:return r(t,u,o.properties),t;case s.THUNK:return v(t,n.patch(t,u,n));default:return t}}function a(e,t){var n=e.parentNode;return n&&n.removeChild(e),p(e,t),null}function f(e,t,n){var r=n.render(t,n);return e&&e.appendChild(r),e}function l(e,t,n,r){var i;if(e.nodeType===3)e.replaceData(0,e.length,n.text),i=e;else{var s=e.parentNode;i=r.render(n,r),s&&i!==e&&s.replaceChild(i,e)}return i}function c(e,t,n,r){var i=o(t,n),s;i?s=n.update(t,e)||e:s=r.render(n,r);var u=e.parentNode;return u&&s!==e&&u.replaceChild(s,e),i||p(e,t),s}function h(e,t,n,r){var i=e.parentNode,s=r.render(n,r);return i&&s!==e&&i.replaceChild(s,e),s}function p(e,t){typeof t.destroy=="function"&&i(t)&&t.destroy(e)}function d(e,t){var n=e.childNodes,r={},i,s,o;for(var u=0;u<t.removes.length;u++)s=t.removes[u],i=n[s.from],s.key&&(r[s.key]=i),e.removeChild(i);var a=n.length;for(var f=0;f<t.inserts.length;f++)o=t.inserts[f],i=r[o.key],e.insertBefore(i,o.to>=a++?null:n[o.to])}function v(e,t){return e&&t&&e!==t&&e.parentNode&&e.parentNode.replaceChild(t,e),t}var r=e("./apply-properties"),i=e("../vnode/is-widget.js"),s=e("../vnode/vpatch.js"),o=e("./update-widget");t.exports=u},{"../vnode/is-widget.js":29,"../vnode/vpatch.js":32,"./apply-properties":14,"./update-widget":19}],18:[function(e,t,n){function a(e,t,n){return n=n||{},n.patch=n.patch&&n.patch!==a?n.patch:f,n.render=n.render||s,n.patch(e,t,n)}function f(e,t,n){var i=c(t);if(i.length===0)return e;var s=o(e,t.a,i),u=e.ownerDocument;!n.document&&u!==r&&(n.document=u);for(var a=0;a<i.length;a++){var f=i[a];e=l(e,s[f],t[f],n)}return e}function l(e,t,n,r){if(!t)return e;var s;if(i(n))for(var o=0;o<n.length;o++)s=u(n[o],t,r),t===e&&(e=s);else s=u(n,t,r),t===e&&(e=s);return e}function c(e){var t=[];for(var n in e)n!=="a"&&t.push(Number(n));return t}var r=e("global/document"),i=e("x-is-array"),s=e("./create-element"),o=e("./dom-index"),u=e("./patch-op");t.exports=a},{"./create-element":15,"./dom-index":16,"./patch-op":17,"global/document":10,"x-is-array":12}],19:[function(e,t,n){function i(e,t){return r(e)&&r(t)?"name"in e&&"name"in t?e.id===t.id:e.init===t.init:!1}var r=e("../vnode/is-widget.js");t.exports=i},{"../vnode/is-widget.js":29}],20:[function(e,t,n){"use strict";function i(e){if(!(this instanceof i))return new i(e);this.value=e}var r=e("ev-store");t.exports=i,i.prototype.hook=function(e,t){var n=r(e),i=t.substr(3);n[i]=this.value},i.prototype.unhook=function(e,t){var n=r(e),i=t.substr(3);n[i]=undefined}},{"ev-store":7}],21:[function(e,t,n){"use strict";function r(e){if(!(this instanceof r))return new r(e);this.value=e}t.exports=r,r.prototype.hook=function(e,t){e[t]!==this.value&&(e[t]=this.value)}},{}],22:[function(e,t,n){"use strict";function d(e,t,n){var r=[],s,o,u,a;return!n&&y(t)&&(n=t,o={}),o=o||t||{},s=c(e,o),o.hasOwnProperty("key")&&(u=o.key,o.key=undefined),o.hasOwnProperty("namespace")&&(a=o.namespace,o.namespace=undefined),s==="INPUT"&&!a&&o.hasOwnProperty("value")&&o.value!==undefined&&!f(o.value)&&(o.value=h(o.value)),m(o),n!==undefined&&n!==null&&v(n,r,s,o),new i(s,o,r,u,a)}function v(e,t,n,i){if(typeof e=="string")t.push(new s(e));else if(typeof e=="number")t.push(new s(String(e)));else if(g(e))t.push(e);else{if(!r(e)){if(e===null||e===undefined)return;throw b({foreignObject:e,parentVnode:{tagName:n,properties:i}})}for(var o=0;o<e.length;o++)v(e[o],t,n,i)}}function m(e){for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];if(f(n))continue;t.substr(0,3)==="ev-"&&(e[t]=p(n))}}function g(e){return o(e)||u(e)||a(e)||l(e)}function y(e){return typeof e=="string"||r(e)||g(e)}function b(e){var t=new Error;return t.type="virtual-hyperscript.unexpected.virtual-element",t.message="Unexpected virtual child passed to h().\nExpected a VNode / Vthunk / VWidget / string but:\ngot:\n"+w(e.foreignObject)+".\n"+"The parent vnode is:\n"+w(e.parentVnode),"\nSuggested fix: change your `h(..., [ ... ])` callsite.",t.foreignObject=e.foreignObject,t.parentVnode=e.parentVnode,t}function w(e){try{return JSON.stringify(e,null,"    ")}catch(t){return String(e)}}var r=e("x-is-array"),i=e("../vnode/vnode.js"),s=e("../vnode/vtext.js"),o=e("../vnode/is-vnode"),u=e("../vnode/is-vtext"),a=e("../vnode/is-widget"),f=e("../vnode/is-vhook"),l=e("../vnode/is-thunk"),c=e("./parse-tag.js"),h=e("./hooks/soft-set-hook.js"),p=e("./hooks/ev-hook.js");t.exports=d},{"../vnode/is-thunk":25,"../vnode/is-vhook":26,"../vnode/is-vnode":27,"../vnode/is-vtext":28,"../vnode/is-widget":29,"../vnode/vnode.js":31,"../vnode/vtext.js":33,"./hooks/ev-hook.js":20,"./hooks/soft-set-hook.js":21,"./parse-tag.js":23,"x-is-array":12}],23:[function(e,t,n){"use strict";function o(e,t){if(!e)return"DIV";var n=!t.hasOwnProperty("id"),o=r(e,i),u=null;s.test(o[1])&&(u="DIV");var a,f,l,c;for(c=0;c<o.length;c++){f=o[c];if(!f)continue;l=f.charAt(0),u?l==="."?(a=a||[],a.push(f.substring(1,f.length))):l==="#"&&n&&(t.id=f.substring(1,f.length)):u=f}return a&&(t.className&&a.push(t.className),t.className=a.join(" ")),t.namespace?u:u.toUpperCase()}var r=e("browser-split"),i=/([\.#]?[a-zA-Z0-9\u007F-\uFFFF_:-]+)/,s=/^\.|#/;t.exports=o},{"browser-split":5}],24:[function(e,t,n){function u(e,t){var n=e,r=t;return o(t)&&(r=a(t,e)),o(e)&&(n=a(e,null)),{a:n,b:r}}function a(e,t){var n=e.vnode;n||(n=e.vnode=e.render(t));if(!(r(n)||i(n)||s(n)))throw new Error("thunk did not return a valid node");return n}var r=e("./is-vnode"),i=e("./is-vtext"),s=e("./is-widget"),o=e("./is-thunk");t.exports=u},{"./is-thunk":25,"./is-vnode":27,"./is-vtext":28,"./is-widget":29}],25:[function(e,t,n){function r(e){return e&&e.type==="Thunk"}t.exports=r},{}],26:[function(e,t,n){function r(e){return e&&(typeof e.hook=="function"&&!e.hasOwnProperty("hook")||typeof e.unhook=="function"&&!e.hasOwnProperty("unhook"))}t.exports=r},{}],27:[function(e,t,n){function i(e){return e&&e.type==="VirtualNode"&&e.version===r}var r=e("./version");t.exports=i},{"./version":30}],28:[function(e,t,n){function i(e){return e&&e.type==="VirtualText"&&e.version===r}var r=e("./version");t.exports=i},{"./version":30}],29:[function(e,t,n){function r(e){return e&&e.type==="Widget"}t.exports=r},{}],30:[function(e,t,n){t.exports="2"},{}],31:[function(e,t,n){function l(e,t,n,r,l){this.tagName=e,this.properties=t||a,this.children=n||f,this.key=r!=null?String(r):undefined,this.namespace=typeof l=="string"?l:null;var c=n&&n.length||0,h=0,p=!1,d=!1,v=!1,m;for(var g in t)if(t.hasOwnProperty(g)){var y=t[g];u(y)&&y.unhook&&(m||(m={}),m[g]=y)}for(var b=0;b<c;b++){var w=n[b];i(w)?(h+=w.count||0,!p&&w.hasWidgets&&(p=!0),!d&&w.hasThunks&&(d=!0),!v&&(w.hooks||w.descendantHooks)&&(v=!0)):!p&&s(w)?typeof w.destroy=="function"&&(p=!0):!d&&o(w)&&(d=!0)}this.count=c+h,this.hasWidgets=p,this.hasThunks=d,this.hooks=m,this.descendantHooks=v}var r=e("./version"),i=e("./is-vnode"),s=e("./is-widget"),o=e("./is-thunk"),u=e("./is-vhook");t.exports=l;var a={},f=[];l.prototype.version=r,l.prototype.type="VirtualNode"},{"./is-thunk":25,"./is-vhook":26,"./is-vnode":27,"./is-widget":29,"./version":30}],32:[function(e,t,n){function i(e,t,n){this.type=Number(e),this.vNode=t,this.patch=n}var r=e("./version");i.NONE=0,i.VTEXT=1,i.VNODE=2,i.WIDGET=3,i.PROPS=4,i.ORDER=5,i.INSERT=6,i.REMOVE=7,i.THUNK=8,t.exports=i,i.prototype.version=r,i.prototype.type="VirtualPatch"},{"./version":30}],33:[function(e,t,n){function i(e){this.text=String(e)}var r=e("./version");t.exports=i,i.prototype.version=r,i.prototype.type="VirtualText"},{"./version":30}],34:[function(e,t,n){function s(e,t){var n;for(var u in e){u in t||(n=n||{},n[u]=undefined);var a=e[u],f=t[u];if(a===f)continue;if(r(a)&&r(f))if(o(f)!==o(a))n=n||{},n[u]=f;else if(i(f))n=n||{},n[u]=f;else{var l=s(a,f);l&&(n=n||{},n[u]=l)}else n=n||{},n[u]=f}for(var c in t)c in e||(n=n||{},n[c]=t[c]);return n}function o(e){if(Object.getPrototypeOf)return Object.getPrototypeOf(e);if(e.__proto__)return e.__proto__;if(e.constructor)return e.constructor.prototype}var r=e("is-object"),i=e("../vnode/is-vhook");t.exports=s},{"../vnode/is-vhook":26,"is-object":11}],35:[function(e,t,n){function c(e,t){var n={a:e};return h(e,t,n,0),n}function h(e,t,n,r){if(e===t)return;var f=n[r],c=!1;if(a(e)||a(t))m(e,t,n,r);else if(t==null)u(e)||(d(e,n,r),f=n[r]),f=x(f,new i(i.REMOVE,e,t));else if(s(t))if(s(e))if(e.tagName===t.tagName&&e.namespace===t.namespace&&e.key===t.key){var h=l(e.properties,t.properties);h&&(f=x(f,new i(i.PROPS,e,h))),f=p(e,t,n,f,r)}else f=x(f,new i(i.VNODE,e,t)),c=!0;else f=x(f,new i(i.VNODE,e,t)),c=!0;else o(t)?o(e)?e.text!==t.text&&(f=x(f,new i(i.VTEXT,e,t))):(f=x(f,new i(i.VTEXT,e,t)),c=!0):u(t)&&(u(e)||(c=!0),f=x(f,new i(i.WIDGET,e,t)));f&&(n[r]=f),c&&d(e,n,r)}function p(e,t,n,r,o){var u=e.children,a=w(u,t.children),f=a.children,l=u.length,c=f.length,p=l>c?l:c;for(var d=0;d<p;d++){var v=u[d],m=f[d];o+=1,v?h(v,m,n,o):m&&(r=x(r,new i(i.INSERT,null,m))),s(v)&&v.count&&(o+=v.count)}return a.moves&&(r=x(r,new i(i.ORDER,e,a.moves))),r}function d(e,t,n){y(e,t,n),v(e,t,n)}function v(e,t,n){if(u(e))typeof e.destroy=="function"&&(t[n]=x(t[n],new i(i.REMOVE,e,null)));else if(s(e)&&(e.hasWidgets||e.hasThunks)){var r=e.children,o=r.length;for(var f=0;f<o;f++){var l=r[f];n+=1,v(l,t,n),s(l)&&l.count&&(n+=l.count)}}else a(e)&&m(e,null,t,n)}function m(e,t,n,r){var s=f(e,t),o=c(s.a,s.b);g(o)&&(n[r]=new i(i.THUNK,null,o))}function g(e){for(var t in e)if(t!=="a")return!0;return!1}function y(e,t,n){if(s(e)){e.hooks&&(t[n]=x(t[n],new i(i.PROPS,e,b(e.hooks))));if(e.descendantHooks||e.hasThunks){var r=e.children,o=r.length;for(var u=0;u<o;u++){var f=r[u];n+=1,y(f,t,n),s(f)&&f.count&&(n+=f.count)}}}else a(e)&&m(e,null,t,n)}function b(e){var t={};for(var n in e)t[n]=undefined;return t}function w(e,t){var n=S(t),r=n.keys,i=n.free;if(i.length===t.length)return{children:t,moves:null};var s=S(e),o=s.keys,u=s.free;if(u.length===e.length)return{children:t,moves:null};var a=[],f=0,l=i.length,c=0;for(var h=0;h<e.length;h++){var p=e[h],d;p.key?r.hasOwnProperty(p.key)?(d=r[p.key],a.push(t[d])):(d=h-c++,a.push(null)):f<l?(d=i[f++],a.push(t[d])):(d=h-c++,a.push(null))}var v=f>=i.length?t.length:i[f];for(var m=0;m<t.length;m++){var g=t[m];g.key?o.hasOwnProperty(g.key)||a.push(g):m>=v&&a.push(g)}var y=a.slice(),b=0,w=[],x=[],T;for(var N=0;N<t.length;){var C=t[N];T=y[b];while(T===null&&y.length)w.push(E(y,b,null)),T=y[b];!T||T.key!==C.key?C.key?(T&&T.key?r[T.key]!==N+1?(w.push(E(y,b,T.key)),T=y[b],!T||T.key!==C.key?x.push({key:C.key,to:N}):b++):x.push({key:C.key,to:N}):x.push({key:C.key,to:N}),N++):T&&T.key&&w.push(E(y,b,T.key)):(b++,N++)}while(b<y.length)T=y[b],w.push(E(y,b,T&&T.key));return w.length===c&&!x.length?{children:a,moves:null}:{children:a,moves:{removes:w,inserts:x}}}function E(e,t,n){return e.splice(t,1),{from:t,key:n}}function S(e){var t={},n=[],r=e.length;for(var i=0;i<r;i++){var s=e[i];s.key?t[s.key]=i:n.push(i)}return{keys:t,free:n}}function x(e,t){return e?(r(e)?e.push(t):e=[e,t],e):t}var r=e("x-is-array"),i=e("../vnode/vpatch"),s=e("../vnode/is-vnode"),o=e("../vnode/is-vtext"),u=e("../vnode/is-widget"),a=e("../vnode/is-thunk"),f=e("../vnode/handle-thunk"),l=e("./diff-props");t.exports=c},{"../vnode/handle-thunk":24,"../vnode/is-thunk":25,"../vnode/is-vnode":27,"../vnode/is-vtext":28,"../vnode/is-widget":29,"../vnode/vpatch":32,"./diff-props":34,"x-is-array":12}]},{},[4])(4)});(function(e){"use strict";var t=e.prototype,n=t.parseFromString;try{if((new e).parseFromString("","text/html"))return}catch(r){}t.parseFromString=function(e,t){if(/^\s*text\/html\s*(?:;|$)/i.test(t)){var r=document.implementation.createHTMLDocument("");return e.toLowerCase().indexOf("<!doctype")>-1?r.documentElement.innerHTML=e:r.body.innerHTML=e,r}return n.apply(this,arguments)}})(DOMParser),function(e){if(typeof exports=="object"&&typeof module!="undefined")module.exports=e();else if(typeof define=="function"&&define.amd)define([],e);else{var t;typeof window!="undefined"?t=window:typeof global!="undefined"?t=global:typeof self!="undefined"?t=self:t=this,t.vdomParser=e()}}(function(){var e,t,n;return function r(e,t,n){function i(o,u){if(!t[o]){if(!e[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=t[o]={exports:{}};e[o][0].call(l.exports,function(t){var n=e[o][1][t];return i(n?n:t)},l,l.exports,r,e,t,n)}return t[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,n){"use strict";function f(e,t){if(!e)return l(document.createTextNode(""));if(typeof e=="string"){var n=s.parseFromString(e,"text/html");n.body.firstChild?e=n.body.firstChild:n.head.firstChild&&(n.head.firstChild.tagName!=="TITLE"||n.title)?e=n.head.firstChild:n.firstChild&&n.firstChild.tagName!=="HTML"?e=n.firstChild:e=document.createTextNode("")}if(typeof e!="object"||!e||!e.nodeType)throw new Error("invalid dom node",e);return l(e,t)}function l(e,t){return e.nodeType===3?c(e):e.nodeType===1||e.nodeType===9?h(e,t):new i("")}function c(e){return new i(e.nodeValue)}function h(e,t){var n=e.namespaceURI!==a?e.namespaceURI:null,i=t&&e.getAttribute(t)?e.getAttribute(t):null;return new r(e.tagName,d(e),p(e,t),i,n)}function p(e,t){var n=[];for(var r=0;r<e.childNodes.length;r++)n.push(l(e.childNodes[r],t));return n}function d(e){var t={};if(!e.hasAttributes())return t;var n;e.namespaceURI&&e.namespaceURI!==a&&(n=e.namespaceURI);var r;for(var i=0;i<e.attributes.length;i++)n?r=m(e.attributes[i]):r=v(e.attributes[i]),r.ns?t[r.name]={namespace:r.ns,value:r.value}:r.isAttr?(t.attributes||(t.attributes={}),t.attributes[r.name]=r.value):t[r.name]=r.value;return t}function v(e){var t,n,r;o[e.name]?t=o[e.name]:t=e.name;if(t==="style"){var i={};e.value.split(";").forEach(function(e){var t=e.indexOf(":");if(t<0)return;i[e.substr(0,t).trim()]=e.substr(t+1).trim()}),n=i}else t.indexOf("data-")===0?(n=e.value,r=!0):n=e.value;return{name:t,value:n,isAttr:r||!1}}function m(e){var t,n;return{name:e.name,value:e.value,ns:u[e.name]||""}}var r=virtualDom.VNode,i=virtualDom.VText,s=new DOMParser,o=e("./property-map"),u=e("./namespace-map"),a="http://www.w3.org/1999/xhtml";t.exports=f},{"./namespace-map":2,"./property-map":10}],2:[function(e,t,n){"use strict";var r=null,i="http://www.w3.org/2001/xml-events",s="http://www.w3.org/1999/xlink",o="http://www.w3.org/XML/1998/namespace",u={about:r,"accent-height":r,accumulate:r,additive:r,"alignment-baseline":r,alphabetic:r,amplitude:r,"arabic-form":r,ascent:r,attributeName:r,attributeType:r,azimuth:r,bandwidth:r,baseFrequency:r,baseProfile:r,"baseline-shift":r,bbox:r,begin:r,bias:r,by:r,calcMode:r,"cap-height":r,"class":r,clip:r,"clip-path":r,"clip-rule":r,clipPathUnits:r,color:r,"color-interpolation":r,"color-interpolation-filters":r,"color-profile":r,"color-rendering":r,content:r,contentScriptType:r,contentStyleType:r,cursor:r,cx:r,cy:r,d:r,datatype:r,defaultAction:r,descent:r,diffuseConstant:r,direction:r,display:r,divisor:r,"dominant-baseline":r,dur:r,dx:r,dy:r,edgeMode:r,editable:r,elevation:r,"enable-background":r,end:r,"ev:event":i,event:r,exponent:r,externalResourcesRequired:r,fill:r,"fill-opacity":r,"fill-rule":r,filter:r,filterRes:r,filterUnits:r,"flood-color":r,"flood-opacity":r,focusHighlight:r,focusable:r,"font-family":r,"font-size":r,"font-size-adjust":r,"font-stretch":r,"font-style":r,"font-variant":r,"font-weight":r,format:r,from:r,fx:r,fy:r,g1:r,g2:r,"glyph-name":r,"glyph-orientation-horizontal":r,"glyph-orientation-vertical":r,glyphRef:r,gradientTransform:r,gradientUnits:r,handler:r,hanging:r,height:r,"horiz-adv-x":r,"horiz-origin-x":r,"horiz-origin-y":r,id:r,ideographic:r,"image-rendering":r,"in":r,in2:r,initialVisibility:r,intercept:r,k:r,k1:r,k2:r,k3:r,k4:r,kernelMatrix:r,kernelUnitLength:r,kerning:r,keyPoints:r,keySplines:r,keyTimes:r,lang:r,lengthAdjust:r,"letter-spacing":r,"lighting-color":r,limitingConeAngle:r,local:r,"marker-end":r,"marker-mid":r,"marker-start":r,markerHeight:r,markerUnits:r,markerWidth:r,mask:r,maskContentUnits:r,maskUnits:r,mathematical:r,max:r,media:r,mediaCharacterEncoding:r,mediaContentEncodings:r,mediaSize:r,mediaTime:r,method:r,min:r,mode:r,name:r,"nav-down":r,"nav-down-left":r,"nav-down-right":r,"nav-left":r,"nav-next":r,"nav-prev":r,"nav-right":r,"nav-up":r,"nav-up-left":r,"nav-up-right":r,numOctaves:r,observer:r,offset:r,opacity:r,operator:r,order:r,orient:r,orientation:r,origin:r,overflow:r,overlay:r,"overline-position":r,"overline-thickness":r,"panose-1":r,path:r,pathLength:r,patternContentUnits:r,patternTransform:r,patternUnits:r,phase:r,playbackOrder:r,"pointer-events":r,points:r,pointsAtX:r,pointsAtY:r,pointsAtZ:r,preserveAlpha:r,preserveAspectRatio:r,primitiveUnits:r,propagate:r,property:r,r:r,radius:r,refX:r,refY:r,rel:r,"rendering-intent":r,repeatCount:r,repeatDur:r,requiredExtensions:r,requiredFeatures:r,requiredFonts:r,requiredFormats:r,resource:r,restart:r,result:r,rev:r,role:r,rotate:r,rx:r,ry:r,scale:r,seed:r,"shape-rendering":r,slope:r,snapshotTime:r,spacing:r,specularConstant:r,specularExponent:r,spreadMethod:r,startOffset:r,stdDeviation:r,stemh:r,stemv:r,stitchTiles:r,"stop-color":r,"stop-opacity":r,"strikethrough-position":r,"strikethrough-thickness":r,string:r,stroke:r,"stroke-dasharray":r,"stroke-dashoffset":r,"stroke-linecap":r,"stroke-linejoin":r,"stroke-miterlimit":r,"stroke-opacity":r,"stroke-width":r,surfaceScale:r,syncBehavior:r,syncBehaviorDefault:r,syncMaster:r,syncTolerance:r,syncToleranceDefault:r,systemLanguage:r,tableValues:r,target:r,targetX:r,targetY:r,"text-anchor":r,"text-decoration":r,"text-rendering":r,textLength:r,timelineBegin:r,title:r,to:r,transform:r,transformBehavior:r,type:r,"typeof":r,u1:r,u2:r,"underline-position":r,"underline-thickness":r,unicode:r,"unicode-bidi":r,"unicode-range":r,"units-per-em":r,"v-alphabetic":r,"v-hanging":r,"v-ideographic":r,"v-mathematical":r,values:r,version:r,"vert-adv-y":r,"vert-origin-x":r,"vert-origin-y":r,viewBox:r,viewTarget:r,visibility:r,width:r,widths:r,"word-spacing":r,"writing-mode":r,x:r,"x-height":r,x1:r,x2:r,xChannelSelector:r,"xlink:actuate":s,"xlink:arcrole":s,"xlink:href":s,"xlink:role":s,"xlink:show":s,"xlink:title":s,"xlink:type":s,"xml:base":o,"xml:id":o,"xml:lang":o,"xml:space":o,y:r,y1:r,y2:r,yChannelSelector:r,z:r,zoomAndPan:r};t.exports=u},{}],3:[function(e,t,n){function r(e){return e&&e.type==="Thunk"}t.exports=r},{}],9:[function(e,t,n){function r(e){this.text=String(e)}t.exports=r,r.prototype.version=version,r.prototype.type="VirtualText"},{}],10:[function(e,t,n){"use strict";var r={abbr:"abbr",accept:"accept","accept-charset":"acceptCharset",accesskey:"accessKey",action:"action",allowfullscreen:"allowFullScreen",allowtransparency:"allowTransparency",alt:"alt",async:"async",autocomplete:"autoComplete",autofocus:"autoFocus",autoplay:"autoPlay",cellpadding:"cellPadding",cellspacing:"cellSpacing",challenge:"challenge",charset:"charset",checked:"checked",cite:"cite","class":"className",cols:"cols",colspan:"colSpan",command:"command",content:"content",contenteditable:"contentEditable",contextmenu:"contextMenu",controls:"controls",coords:"coords",crossorigin:"crossOrigin",data:"data",datetime:"dateTime","default":"default",defer:"defer",dir:"dir",disabled:"disabled",download:"download",draggable:"draggable",dropzone:"dropzone",enctype:"encType","for":"htmlFor",form:"form",formaction:"formAction",formenctype:"formEncType",formmethod:"formMethod",formnovalidate:"formNoValidate",formtarget:"formTarget",frameBorder:"frameBorder",headers:"headers",height:"height",hidden:"hidden",high:"high",href:"href",hreflang:"hrefLang","http-equiv":"httpEquiv",icon:"icon",id:"id",inputmode:"inputMode",ismap:"isMap",itemid:"itemId",itemprop:"itemProp",itemref:"itemRef",itemscope:"itemScope",itemtype:"itemType",kind:"kind",label:"label",lang:"lang",list:"list",loop:"loop",manifest:"manifest",max:"max",maxlength:"maxLength",media:"media",mediagroup:"mediaGroup",method:"method",min:"min",minlength:"minLength",multiple:"multiple",muted:"muted",name:"name",novalidate:"noValidate",open:"open",optimum:"optimum",pattern:"pattern",ping:"ping",placeholder:"placeholder",poster:"poster",preload:"preload",radiogroup:"radioGroup",readonly:"readOnly",rel:"rel",required:"required",role:"role",rows:"rows",rowspan:"rowSpan",sandbox:"sandbox",scope:"scope",scoped:"scoped",scrolling:"scrolling",seamless:"seamless",selected:"selected",shape:"shape",size:"size",sizes:"sizes",sortable:"sortable",span:"span",spellcheck:"spellCheck",src:"src",srcdoc:"srcDoc",srcset:"srcSet",start:"start",step:"step",style:"style",tabindex:"tabIndex",target:"target",title:"title",translate:"translate",type:"type",typemustmatch:"typeMustMatch",usemap:"useMap",value:"value",width:"width",wmode:"wmode",wrap:"wrap"};t.exports=r},{}]},{},[1])(1)});(function(){window.Template={},window.Component={};var pipe=EventPipe.pipe("compile");(function(){function l(e){this.toRender=!1,this.loaded=!1,this.loadedText="",this.tplName="",this.queue=[],this.tplCache={},this._node=null,this.vTree=null,this.vRoot=null,this.renderData=null,this.timer=null,this.binded=!1;var t=this;if(e){var n=e+".tpl",r=e+".js";resourceMap&&resourceMap["/"+r]&&(r=resourceMap["/"+r].slice(1)),_.ajax.get(n,{t:(new Date).getTime()},function(e){function i(){t.loaded=!0,t.loadedText=e,t._loadDone()}var n=t.tplName=d(e);Template[n]||(Template[n]=new XTemplate(n)),_.loadJs(r,i,i)})}}function c(e){console.time("html2vdom");var t=window.vdomParser(e);return console.timeEnd("html2vdom"),t}function h(e){var t=this,n={},r=e.split(" ");return r.forEach(function(e,t){var r=e.replace(/^\s*|\s*$/g,"").split("=");r[0]&&(n[r[0]]=r[1].slice(1,-1))}),n}function p(e){var t=e.replace(/\r/g,"");return t=t.replace(/\n/g,""),t=t.replace(/\t/g,""),t}function d(e){e=e.replace(/^\s*|\s*$/g,"");var t=e.match(/<template\s*name\s*=\s*"(\w+)">/);return t&&t.length>1?t[1]:""}var e="|template|a|b|body|br|button|center|cite|code|comment|dd|div|dl|dt|em|embed|fieldset|font|form|frame|head|hr|html|i|iframe|img|input|label|legend|li|link|meta|ol|option|p|pre|script|select|span|strong|style|sub|sup|table|tbody|td|textarea|th|thead|tr|ul|h1|h2|h3|h4|h5|h6|",t=/<template\s*name\s*=\s*"([^\"]+)"\s*>(((?!<\/template>).)*)<\/template>/g,n=/\{\{#>\s*(.*?)\}\}/,r=/\{\{>transclude\}\}/,i=/\{\{#if\s*(.*?)\}\}(((?!\{\{#if).)*)\{\{\/if\}\}/,s=/\{\{#each\s*(\w+)\}\}(((?!\{\{#each\}\}).)*)\{\{\/each\}\}/,o=/\{\{#transclude\}\}(((?!\{\{#transclude\}\}).)*)\{\{\/transclude\}\}/,u=/\{\{#component\s*(.*?)\}\}(((?!\{\{#component\}\}).)*)\{\{\/component\}\}/,a={},f=!0;a.load=function(e){return new l(e)},a.render=function(e,t,n){var r=d(e);Template[r]||(Template[r]=new XTemplate(r));var i=new l;i.loadedText=e,i.renderData=t,i._renderComplete=function(e){n(e)},i._render(e,t)},l.prototype.render=function(e,t){var n=this;n.toRender=!0,n.renderData=t,n.view||(n.view={});if(n.view.template!=e.template){var r=document.querySelector(e.seletor),i=document.createElement("div");i.style.width="100%",i.style.height="100%",r.innerHTML="",r.appendChild(i),n.view=e,n.view.container=i,n.viewChange=!0}else n.viewChange=!1;n.loaded&&n._loadDone()},l.prototype._loadDone=function(){var e=this;e.toRender&&(e.binded||(e.binded=!0,Template[e.tplName].bindEvent(e.view.container)),e._render(e.loadedText,e.renderData))},l.prototype._render=function(e,n){var r=this;e=p(e),r.queue.length=0,t.lastIndex=0;var i=t.exec(e),s=_.md5();r.queue.push({id:s,tplName:i[1],placeholder:i[0],content:i[2],data:n,global:r.renderData,parent:null}),r._getComponent(i[2]),r._renderTemplate()},l.prototype._getComponent=function(t){var n=this;n.componentTag=[];var r=document.createElement("div");r.innerHTML=t,_.recurse(r,function(t){var r=t.tagName.toLowerCase();if(e.indexOf("|"+r+"|")==-1){var i=/<(\w+)(?:(\s|.)*?)>/.exec(t.outerHTML);n.componentTag.push(i[1])}})},l.prototype._renderComplete=function(e){var t=this;if(f)if(!t.view.vTree||t.viewChange)t.view.vTree=c(e),t.view.container.appendChild(virtualDom.create(t.view.vTree)),pipe.write("renderComplete");else{var n=c(e),r=virtualDom.diff(t.view.vTree,n);virtualDom.patch(t.view.container.firstChild,r),t.view.vTree=n,pipe.write("renderComplete")}else t.view.container.innerHTML=e},l.prototype._synchronizeDom=function(){var e=this;e.view.vTree=c(e.view.container.innerHTML)},l.prototype._renderTemplate=function(){var e=this;if(e.queue.length>0){var t=e.queue.pop();e._renderCommon(t)}},l.prototype._renderCommon=function(e,t){var r=this,a=e.id,f=e.tplName,l=e.placeholder,c=e.content,h=e.data,p=e.parent;o.lastIndex=0,u.lastIndex=0,s.lastIndex=0,n.lastIndex=0,console.time("match");if(o.test(c))r._renderTransclude(e);else if(u.test(c))r._renderComponent(e);else if(r.componentTag.length>0&&!t){var d=r.componentTag.shift(),v=new RegExp("<("+d+")s*([^>]*)>(((?!<"+d+").)*)</"+d+">","i");v.test(c)?r._renderComponentTag(v,e):(r.componentTag.push(d),r._renderCommon(e,!0))}else if(s.test(c))r._renderEach(e);else if(i.test(c))r._renderIf(e);else if(n.test(c))r._renderInclude(e);else{var m=r._renderNormal(e);r.queue.length>0?(r._setQueueItemContent(p,e.placeholder,m),r._renderTemplate()):r._renderComplete(m)}console.timeEnd("match")},l.prototype._renderComponentTag=function(e,t){var n=this;n.queue.push(t);var r=t.id,i=t.tplName,s=t.content,o=t.data;e.lastIndex=0;var u=e.exec(s),a=u[0],f=u[1],l=u[3];if(l){var c=_.md5();n.queue.push({id:c,tplName:i,placeholder:a,content:"{{#component "+f+"}}"+a+"{{/component}}",data:o,global:n.renderData,parent:r});var h=_.md5();n.queue.push({id:h,tplName:i,placeholder:l,content:"{{#transclude}}"+l+"{{/transclude}}",data:o,global:n.renderData,parent:c})}else{var c=_.md5();n.queue.push({id:c,tplName:i,placeholder:a,content:"{{#component "+f+"}}"+a+"{{/component}}",data:o,global:n.renderData,parent:r})}n._renderTemplate()},l.prototype._renderComponent=function(e){function m(){for(var e in d){var r=d[e],i=/\{\{(.*?)\}\}/.exec(r);i&&(d[e]=s[i[1]])}d.name||(d.name=_.md5()),v&&(d.transclude=v);var o="com_"+_.md5();Component[l].new(o,d.name,d,t.tplName,function(e){e.render(function(e){t._setQueueItem(n,{content:'<component id="'+o+'">'+e+"</component>"}),t._renderTemplate()})})}var t=this;t.queue.push(e);var n=e.id,r=e.tplName,i=e.content,s=e.data;u.lastIndex=0;var o=u.exec(i),f=o[0],l=o[1],c=o[2],p=new RegExp("<("+l+")s*([^>]*)>(((?!<"+l+").)*)</"+l+">","i"),o=p.exec(c),f=o[0],l=_.upFirstLetter(o[1]),d=h(o[2]),v=o[3];Component[l]?Component[l].opts&&m():a.loadComponent(l,function(){m()})},l.prototype._renderTransclude=function(e){var t=this,n=e.id,r=e.tplName,i=e.content,s=e.data;o.lastIndex=0;var u=o.exec(i),a=u[0],f=u[1],l=_.md5();t.queue.push({id:l,tplName:r,placeholder:a,content:f,data:s,global:t.renderData,parent:n}),t._renderTemplate()},l.prototype._renderEach=function(e){var t=this;t.queue.push(e);var n=e.id,r=e.tplName,i=e.content,o=e.data,u=[],a=[];s.lastIndex=0;var f=s.exec(i),l=f[0],c=f[2],h;Array.isArray(o)?h=o:h=o[f[1]],h=h||[];var p=_.md5();t.queue.push({id:p,tplName:r,placeholder:l,content:c,data:h,global:t.renderData,parent:n}),h.forEach(function(e,n){u.push(c);var i=_.md5();t.queue.push({id:i,tplName:r,placeholder:c,content:c,data:e,global:t.renderData,parent:p})}),t._setQueueItem(p,{content:u.join("")}),t._renderTemplate()},l.prototype._renderIf=function(e){var t=this;t.queue.push(e);var n=e.id,r=e.tplName,s=e.content,o=e.data;i.lastIndex=0;var u=i.exec(s),a=u[1],f=u[2],l,c,h;if(f.indexOf("{{#else}}")!=-1){var p=f.split("{{#else}}");l=p[0],c=p[1]}else l=f;h=Template[r].eval(a,o,t.renderData)?l:c||"";var d=_.md5();t.queue.push({id:d,tplName:r,placeholder:u[0],content:h,data:o,global:t.renderData,parent:n}),t._renderTemplate()},l.prototype._renderInclude=function(e){function h(e){t.lastIndex=0;var n=t.exec(e),s=_.md5();r.queue.push({id:s,tplName:n[1],placeholder:f[0],content:n[2],data:a,global:r.renderData,parent:i}),r._renderTemplate()}var r=this;r.queue.push(e);var i=e.id,s=e.tplName,o=e.placeholder,u=e.content,a=e.data;n.lastIndex=0;var f=n.exec(u),l=f[1]+".tpl",c=f[1]+".js";resourceMap&&resourceMap["/"+c]&&(c=resourceMap["/"+c].slice(1)),r.tplCache[l]?h(r.tplCache[l]):_.ajax.get(l,{t:(new Date).getTime()},function(e){function n(){h(e)}e=p(e),r.tplCache[l]=e;var t=d(e);Template[t]||(Template[t]=new XTemplate(t)),_.loadJs(c,n,n)})},l.prototype._renderNormal=function(e){var t=this,n=e.tplName;return Template[n].compile(e)},l.prototype._getQueueItem=function(e){var t=this,n=t.queue.filter(function(t){return t.id===e});return n},l.prototype._setQueueItem=function(e,t){var n=this,r=n.queue.filter(function(t){return t.id===e});if(r.length==1){r=r[0];for(var i in t)r[i]=t[i]}},l.prototype._setQueueItemContent=function(e,t,n){var r=this,i=r.queue.filter(function(t){return t.id===e});i.length==1&&(i=i[0],i.content=i.content.replace(t,n))},hydra.load=a.load,hydra.render=a.render,window.Mustang=a})();var XTemplate=function(){function XTemplate(e){this.name=e,this._fields={},this._filters={},this._events={}}return XTemplate.prototype.helpers=function(e){for(var t in e)this._fields[t]=e[t]},XTemplate.prototype.filters=function(e){for(var t in e)this._filters[t]=e[t]},XTemplate.prototype.events=function(e){for(var t in e)this._events[t.replace("^s*|s*$","")]=e[t]},XTemplate.prototype._mixin=function(e){var t=this._fields,n=this._filters;for(var r in t){var i=t[r];typeof i=="function"?e[r]=i.apply(e):e[r]=i}},XTemplate.prototype.compile=function(e){this._mixin(e.data);var t=e.content,n=e.data,r=e.global,i=this._filters,s=t.replace(/\{\{(.*?)\}\}/g,function(e,t){var s,o,u;if(t.indexOf("|")>0){var a=t.split("|");s=_.trim(a[0]),u=_.trim(a[1])}else t.indexOf(">")==0?s=t.slice(1):s=_.trim(t);var f;if(s.indexOf(".")!=-1){var f=s.split("."),o;f[0]=="top"?o=r:o=n[f[0]],_.each(f,function(e,t){e>0&&o&&(o=o[t])})}else s=="$item"?o=n:o=n[s];return u&&(i[u]?o=i[u](o):console.error("filter ["+u+"] is not exist")),o===undefined&&(o=""),o});return s},XTemplate.prototype.eval=function(exp,data,global){this._mixin(data),exp=exp.replace(/\s/g,"");var mats=/(\w+)(<|>|==|\!=)(.*)$/.exec(exp);return eval("'"+(data[mats[1]]||global[mats[1]]||mats[1])+"'"+mats[2]+mats[3])},XTemplate.prototype.bindEvent=function(e){e||console.error("[node] can't be null");for(var t in this._events){var n=this._events[t],r=t.split(" "),i=r.pop();DomEvent.delegate(e,r.join(" "),i,n)}},XTemplate}();(function(e){function t(e){this.name=e}function n(e,t,n,r){this.id=e,this.name=t,this.opts=n,this.template=r;var i=this;pipe.receive({renderComplete:function(){console.log(i.id,"pipe receive");var e=document.querySelector("#"+i.id);if(!e)return;i.opts.$el=e,i.opts.name=i.name;var t=app.getCurrentTemplate();i.opts.eventPipe=EventPipe.pipe(t.tplName+"_innerPipe");var n=i.opts.render;n.call(i.opts),t._synchronizeDom(),i.bindEvent()}})}e.component=function(e,n){console.log("[",e,"] loaded",n),e=_.upFirstLetter(e),Component[e]||(Component[e]=new t(e)),Component[e].opts=n},e.loadComponent=function(e,n){if(e){Component[e]||(Component[e]=new t(e));var r=_.downFirstLetter(e),i="component/"+r+"/"+r+".js";resourceMap&&resourceMap["/js/"+i]&&(i=resourceMap["/js/"+i].slice(1));var s="component/"+r+"/"+r+".css";resourceMap&&resourceMap["/js/"+s]&&(s=resourceMap["/js/"+s].slice(1)),_.loadJs(i,function(){n&&n(Component[e])}),_.loadCss(s)}},t.prototype.new=function(e,t,r,i,s){var o=_.upFirstLetter(this.name),u=Component[o].opts;console.log(">",this.name);if(u.initState)u.initState.call(u,function(){r&&_.extend(u.props,r);var o=Template[i],a=new n(e,t,u,o);s&&s(a)});else{r&&_.extend(u.props,r);var a=Template[i],f=new n(e,t,u,a);s&&s(f)}},t.prototype.newInstance=function(e){var t=_.upFirstLetter(this.name),r=Component[t].opts;console.log(">",this.name),e&&_.extend(r.props,e);var i="com_"+_.md5(),s=_.md5(),o=app.getCurrentTemplate(),u=Template[o.tplName],a=new n(i,s,r,u);a.render(function(e){var t=document.createElement("div");t.innerHTML='<component id="'+i+'">'+e+"</component>",o._node.appendChild(t.children[0])})},n.prototype.bindEvent=function(){var e=this;if(e.binded)return;e.binded=!0;var t=e.opts,n=t.events.call(t),r={};for(var i in n)r[i]=n[i];var s=document.querySelector("#"+e.id);e.template.events(r),e.template.bindEvent(s)},n.prototype.render=function(t){var n=this.opts,r=e.render(n.template,n.props,function(e){t(e)})},hydra.component=e.component,hydra.loadComponent=e.loadComponent})(Mustang)})();(function(window){function Mvc(e){this.name=e,this._routParms={},_.extend(this,Event)}function View(e,t,n){this.template=t,this.seletor=e}function Scope(e,t,n){this._id=e,this._tpl=t,this._controller=n,this.eventPipe=EventPipe.pipe(t.tplName+"_innerPipe")}function newInstance(strClass){function F(){return clsClass.apply(this,args)}var args=Array.prototype.slice.call(arguments,1),clsClass=eval(strClass);return F.prototype=clsClass.prototype,new F}function newFunction(e){function n(){return e.apply(this,t)}var t=Array.prototype.slice.call(arguments,1);return n.prototype=e.prototype,new n}function loadController(e){var t="/controllers/"+e+".js",n=_config.base+t;resourceMap&&resourceMap["/js"+t]&&(n=_config.base+resourceMap["/js"+t].slice(3)),_.loadJs(n)}function loadModule(e){if(e.length>0)for(var t=0,n=e.length;t<n;t++){var r="/"+e[t]+".js",i=_config.base+r;resourceMap&&resourceMap["/js"+r]&&(i=_config.base+resourceMap["/js"+r].slice(3)),_.loadJs(i)}}function newDataScope(e,t){var n=new Scope(_.md5(),null,null);return _.extend(n,e),t&&t.filter&&(n.filter=t.filter),n}function getDependence(e){if(e){var t=_.trim(e).split(","),n=[];return _.each(t,function(e,t){var r=_.trim(t);r&&n.push(r)}),n}return null}function checkDependence(e){var t=_moduleBus[e];if(t){var n=t.dependences,r=!0;n.length>0&&_.each(n,function(e,t){var n=_moduleBus[t];if(!n||n.state!=STATE.LOADED)r=!1}),r&&(t.state=STATE.LOADED,globalDependenceCheck())}}function globalDependenceCheck(){for(var e in _moduleBus){var t=_moduleBus[e];if(t&&t.state!=STATE.LOADED){var n=t.dependences,r=!0;n.length>0&&_.each(n,function(e,t){var i=_moduleBus[n[e]];if(!i||i.state!=STATE.LOADED)r=!1}),r&&(t.state=STATE.LOADED,checkRunStack(t.name),globalDependenceCheck())}else t&&t.state==STATE.LOADED&&checkRunStack(t.name)}}function checkRunStack(e){if(_runStack.length>0&&_runStack[0].controller==e){var t=_runStack.pop();runController(t.controller,t.tpl,t.view)}}function runController(e,t,n){var r=_moduleBus[e];if(r&&r.state==STATE.LOADED){var i=_.md5()+"_"+_.uuid(),s=new Scope(i,t,e);_controllerBus[e]={scope:s,view:n,states:{}};var o=newState(e,function(){_controllerBus[e].scope.apply()});_controllerBus[e].states[e]=o;if(r.dependences){var u=[];_.each(r.dependences,function(t,n){var r=injectModule(e,_moduleBus[n]);u.push(r)})}r.fn.apply(s,u),_currentController=e,s.apply()}else _runStack.push({controller:e,tpl:t,view:n}),loadController(e)}function injectModule(e,t){if(t&&t.state==STATE.LOADED){var n=[];t.dependences&&_.each(t.dependences,function(t,r){var i=_moduleBus[r];switch(i.type){case"plugin":n.push(injectModule(i));break;case"store":var s=newState(i.name,function(){_controllerBus[e].scope.apply()});_controllerBus[e].states[i.name]=s,n.push(i.fn.apply(StoreUtil,[s]))}});switch(t.type){case"plugin":var r=t.fn.apply(newDataScope({}),n);return _.copy(r,Event);case"store":var i=_controllerBus[e],s=newState(t.name,function(){i.scope.apply()});return i.states||(i.states={}),i.states[t.name]=s,t.fn.apply(StoreUtil,[s])}}}var _moduleBus={},_controllerBus={},_viewBus={},_runStack=[],_parseTree={},_parseBus={},_config=null,_uid=1,_currentController=null,_cssBus={},_currentPath,STATE={INIT:0,LOADED:1,RUN:2};Mvc.prototype.controller=function(e){var t,n,r=Array.prototype.slice.call(arguments,1);r.length==2?(t=r[0],n=r[1]):(t="",n=r[0]),_.isFunction(n)||console.error("controller [",e,"], arguments error.");var i=e;if(_moduleBus[i]){console.error("controller [",e,"] already exist.");return}var s=getDependence(t)||[];_moduleBus[i]={name:i,type:"controller",state:STATE.INIT,states:{},dependences:s,fn:n},loadModule(s),checkDependence(i)},Mvc.prototype.store=function(e){var t,n,r=Array.prototype.slice.call(arguments,1);r.length==2?(t=r[0],n=r[1]):(t="",n=r[0]),_.isFunction(n)||console.error("store [",e,"], arguments error.");var i="stores/"+e;if(_moduleBus[i]){console.error("store [",e,"] already exist.");return}var s=getDependence(t)||[];_moduleBus[i]={name:i,type:"store",state:STATE.INIT,states:{},dependences:s,fn:n},loadModule(s),checkDependence(i)},Mvc.prototype.config=function(e){function r(e){var r=n[e];/^\//.test(e)&&Path.map("#"+e).to(function(){r.redirect?Path.dispatch(r.redirect):(r.css&&(_cssBus[r.css]||(_.loadCss(r.css),_cssBus[r.css]=!0)),t._route(e),t.dispatchEvent("pathChange","#"+e))})}var t=this;_config=e;var n=e.router;runController("AppController"),_.each(n,function(e,t){r(e)}),Path.listen(),location.hash==""&&t.redirect("/")},Mvc.prototype.redirect=function(e){_currentPath=e,location.href=location.href.split("#")[0]+"#"+e},Mvc.prototype.setRouteParam=function(e){var t=this;_.each(e,function(e,n){t._routParms[e]=n})},Mvc.prototype.getRouteParam=function(e){return this._routParms[e]},Mvc.prototype.removeRouteParam=function(e){delete this._routParms[e]},Mvc.prototype.emptyRouteParam=function(e){this._routParms={}},Mvc.prototype._route=function(e){var t=_config.router[e];if(t&&t.template){if(_currentController){var n=_controllerBus[_currentController];n&&n.scope&&n.scope.finalize&&n.scope.finalize()}_currentPath=e;var r=t.view||_config.view;_viewBus[r]&&delete _viewBus[r],_viewBus[r]=new View(r,t.template);var i=Mustang.load(_config.base+"/"+t.template);runController(t.controller,i,_viewBus[r])}},Mvc.prototype.getCurrentRoute=function(){return _currentPath},Mvc.prototype.getCurrentTemplate=function(){return _controllerBus[_currentController].scope._tpl},Scope.prototype.on=function(){},Scope.prototype.dispatch=function(){},Scope.prototype.getState=function(){var e=_controllerBus[this._controller].states;return e[this._controller]},Scope.prototype.getMergedState=function(){var e=_controllerBus[this._controller].states,t={};for(var n in e)_.extend(t,e[n].state);return t},Scope.prototype.setState=function(e){var t=_controllerBus[this._controller].states;_.extend(t[this._controller].state,e),this.apply()},Scope.prototype.apply=function(){var e=this._tpl,t=_moduleBus[this._controller];if(t&&t.state==STATE.LOADED&&_controllerBus[t.name]){var n=_controllerBus[t.name].view,r=this.getMergedState();r&&e.render(n,r)}};var Path={map:function(e){return Path.routes.defined.hasOwnProperty(e)?Path.routes.defined[e]:new Path.core.route(e)},root:function(e){Path.routes.root=e},rescue:function(e){Path.routes.rescue=e},match:function(e,t){var n={},r=null,i,s,o,u,a;for(r in Path.routes.defined)if(r!==null&&r!==undefined){r=Path.routes.defined[r],i=r.partition();for(u=0;u<i.length;u++){s=i[u],a=e;if(s.search(/:/)>0)for(o=0;o<s.split("/").length;o++)o<a.split("/").length&&s.split("/")[o].charAt(0)===":"&&(n[s.split("/")[o].replace(/:/,"")]=a.split("/")[o],a=a.replace(a.split("/")[o],s.split("/")[o]));if(s===a)return t&&(r.params=n),r}}return null},dispatch:function(e){var t,n;if(Path.routes.current!==e){Path.routes.previous=Path.routes.current,Path.routes.current=e,n=Path.match(e,!0),Path.routes.previous&&(t=Path.match(Path.routes.previous),t!==null&&t.do_exit!==null&&t.do_exit());if(n!==null)return n.run(),!0;Path.routes.rescue!==null&&Path.routes.rescue()}},listen:function(){var e=function(){Path.dispatch(location.hash)};location.hash===""&&Path.routes.root!==null&&(location.hash=Path.routes.root),history.pushState?window.addEventListener("popstate",e):"onhashchange"in window&&(!document.documentMode||document.documentMode>=8)?window.onhashchange=e:setInterval(e,100),location.hash!==""&&Path.dispatch(location.hash)},core:{route:function(e){this.path=e,this.action=null,this.do_enter=[],this.do_exit=null,this.params={},Path.routes.defined[e]=this}},routes:{current:null,root:null,rescue:null,previous:null,defined:{}}};Path.core.route.prototype={to:function(e){return this.action=e,this},enter:function(e){return e instanceof Array?this.do_enter=this.do_enter.concat(e):this.do_enter.push(e),this},exit:function(e){return this.do_exit=e,this},partition:function(){var e=[],t=[],n=/\(([^}]+?)\)/g,r,i;while(r=n.exec(this.path))e.push(r[1]);t.push(this.path.split("(")[0]);for(i=0;i<e.length;i++)t.push(t[t.length-1]+e[i]);return t},run:function(){var e=!1,t,n,r;if(Path.routes.defined[this.path].hasOwnProperty("do_enter")&&Path.routes.defined[this.path].do_enter.length>0)for(t=0;t<Path.routes.defined[this.path].do_enter.length;t++){n=Path.routes.defined[this.path].do_enter[t].apply(this,null);if(n===!1){e=!0;break}}e||Path.routes.defined[this.path].action()}},hydra.module=function(e){return new Mvc(e)},hydra._=_})(window)